<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‚°ì‚¬íƒœ ê°ì§€ ì‹œê°í™”</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      background-color: #f0f0f0;
      overflow-y: auto;
    }

    header {
      background-color: #263238;
      color: white;
      text-align: center;
      padding: 12px 0;
      font-size: 24px;
      font-weight: bold;
    }

    .container {
      display: flex;
      flex-direction: row;
      min-height: 100vh;
    }

    .left-panel-wrapper {
      flex: 3;
      padding: 10px;
      box-sizing: border-box;
      background-color: #fff;
    }

    .left-panel-wrapper h2 {
      font-size: 18px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }

    .left-panel {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .left-panel canvas {
      width: 100%;
      height: 100px;
    }

    .custom-section {
      margin-top: 30px;
      padding: 10px;
      border-top: 1px dashed #ccc;
      background-color: #fafafa;
    }

    .right-panel {
      flex: 1;
      padding: 10px;
      box-sizing: border-box;
      background-color: #fff;
      border-left: 1px solid #ccc;
      overflow-y: auto;
    }

    .right-panel h2 {
      font-size: 18px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }

    iframe {
      width: 100%;
      border: 1px solid #ccc;
    }

    .subsection {
      margin-top: 20px;
    }

    .subsection h3 {
      font-size: 16px;
      margin-bottom: 8px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 4px;
    }

    button {
      padding: 8px 12px;
      font-size: 14px;
      background-color: #3d8ddd;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .legend-horizontal {
      font-size: 14px;
      background-color: #f9f9f9;
      padding: 8px 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
  </style>
</head>
<body>
  <header>ì‚°ì‚¬íƒœ ê°ì§€ ì‹œìŠ¤í…œ</header>
  <div class="container">

    <!-- ì¢Œì¸¡: ì„¼ì„œ -->
    <div class="left-panel-wrapper">
      <h2>ì„¼ì„œ íŒŒí˜•</h2>
      <div class="left-panel">
        <div><canvas id="gyroChart"></canvas></div>
        <div><canvas id="accelChart"></canvas></div>
        <div><canvas id="pitchChart"></canvas></div>
        <div><canvas id="moistureChart"></canvas></div>
        <div><canvas id="tempChart"></canvas></div>
        <div><canvas id="rollChart"></canvas></div>
      </div>

      <div class="custom-section" style="display: flex; flex-direction: row; gap: 30px; align-items: flex-start;">
        <!-- ì‹¤ì‹œê°„ ìœ„í—˜ë„ -->
        <div style="min-width: 200px;">
          <h3>ì‹¤ì‹œê°„ ìœ„í—˜ë„</h3>
          <div id="riskDisplay">â³ ë°ì´í„° ìˆ˜ì‹  ì¤‘...</div>
          
          <div id="riskStreak" style="margin-top: 8px; font-size: 14px; color: #b71c1c;"></div>

          <div style="margin-top: 12px;">
            <label style="font-size: 14px;">
              <!--<input type="checkbox" id="riskAlert" style="margin-right: 6px;">
              ìœ„í—˜ë„ ì•Œë¦¼ë°›ê¸°-->
            </label>
          </div>
        </div>
        
        <!-- ìœ„í—˜ë„ í•´ì„ ë° ê´€ë¦¬ì ëŒ€ì‘ -->
        <div style="flex: 1;">
          <h3>ìœ„í—˜ë„ í•´ì„ ë° ê´€ë¦¬ì ëŒ€ì‘</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <!-- ì¢Œì¸¡ ì—´: ë‚®ì€~ë³´í†µ -->
            <ul style="font-size: 14px; line-height: 1.8; padding-left: 18px; margin: 0;">
              <li><span style="color: blue;"><b>ğŸŸ¦ ë§¤ìš° ë‚®ìŒ</b></span> â€” ë””ë°”ì´ìŠ¤ê°€ ìˆ˜ì§ ìƒíƒœì´ë©°, í† ì–‘ë„ ê±´ì¡°í•œ ì•ˆì • ìƒíƒœì…ë‹ˆë‹¤.<br>
                <i>ğŸ“Œ ì¡°ì¹˜: ì •ìƒ ì‘ë™ ì—¬ë¶€ë§Œ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸</i>
              </li>
              <li><span style="color: green;"><b>ğŸŸ© ë‚®ìŒ</b></span> â€” ìˆ˜ë¶„ê°ì§€ê°€ ì‹œì‘ë˜ë©° ì•½ê°„ì˜ ë°”ëŒì— ì˜í•œ í”ë“¤ë¦¼ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                <i>ğŸ“Œ ì¡°ì¹˜: ê¸°ìƒ ë° í† ì–‘ ìƒíƒœ ì ê²€</i>
              </li>
              <li><span style="color: goldenrod;"><b>ğŸŸ¨ ë³´í†µ</b></span> â€” ìˆ˜ë¶„ì´ ìƒìŠ¹í•˜ë©° ì•½ê°„ì˜ ê¸°ìš¸ê¸° ë³€í™”ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                <i>ğŸ“Œ ì¡°ì¹˜: ê¸°ê¸°ì˜ ê³ ì • ìƒíƒœë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸</i>
              </li>
            </ul>
      
            <!-- ìš°ì¸¡ ì—´: ë†’ìŒ~ë§¤ìš° ë†’ìŒ -->
            <ul style="font-size: 14px; line-height: 1.8; padding-left: 18px; margin: 0;">
              <li><span style="color: orange;"><b>ğŸŸ§ ë†’ìŒ</b></span> â€” ê¸°ìš¸ê¸°ê°€ ë¶ˆì•ˆì •í•  ìˆ˜ ìˆê³  ì§„ë™ì— ì˜í•œ ë–¨ë¦¼ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                <i>ğŸ“Œ ì¡°ì¹˜: ìœ„í—˜ë„ ë° ì„¼ì„œ íŒŒí˜• ì§‘ì¤‘ ëª¨ë‹ˆí„°ë§</i>
              </li>
              <li><span style="color: red;"><b>ğŸŸ¥ ë§¤ìš° ë†’ìŒ</b></span> â€” ìˆ˜ì§ì´ë˜ ë””ë°”ì´ìŠ¤ê°€ 45ë„ ì´ìƒ ê¸°ìš¸ì—ˆì„ ìˆ˜ ìˆìœ¼ë©° ì‚°ì‚¬íƒœ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.<br>
                <i>ğŸ“Œ ì¡°ì¹˜: ì´ ë“±ê¸‰ì´ ê³„ì† ìœ ì§€ë  ì‹œ í˜„ì¥ ì ê²€ì„ ê³ ë ¤í•˜ë©°, ì•ˆì „ ëŒ€í”¼ ê³„íšì„ ì¤€ë¹„</i>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- ìš°ì¸¡: ì§€ë„ + CCTV -->
    <div class="right-panel">
      <h2>2025ë…„ êµ­ë‚´ ì‚°ì‚¬íƒœ ìœ„í—˜ì§€ì—­</h2>
      <iframe src="/static/folium_risk_map.html" height="300px"></iframe>

      <div class="legend-horizontal">
        <span style="color: blue;">ğŸŸ¦ ë§¤ìš° ë‚®ìŒ</span>
        <span style="color: green;">ğŸŸ© ë‚®ìŒ</span>
        <span style="color: goldenrod;">ğŸŸ¨ ë³´í†µ</span>
        <span style="color: orange;">ğŸŸ§ ë†’ìŒ</span>
        <span style="color: red;">ğŸŸ¥ ë§¤ìš° ë†’ìŒ</span>
        <span>
          <img src="/static/device_icon.png" alt="ë””ë°”ì´ìŠ¤ ë§ˆì»¤" style="height: 20px; vertical-align: middle;">
          ë””ë°”ì´ìŠ¤
        </span>
      </div>

      <div class="subsection">
        <h3>ë””ë°”ì´ìŠ¤ ì£¼ë³€ CCTV</h3>
        <iframe id="cctv_frame" height="240px" style="margin-top:10px;"></iframe>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/static/chart.js"></script>
  <script src="/static/cctv.js"></script>
  <script src="/static/risk_monitor.js"></script>
  <script>
    async function updateRisk() {
      try {
        const response = await fetch('/risk', { cache: "no-cache" });
        const data = await response.json();
        const level = data.label;
        const score = data.risk;

        let labelText = "ì•Œ ìˆ˜ ì—†ìŒ";
        let color = "gray";

        if (level === 0) { labelText = "ë§¤ìš° ë‚®ìŒ"; color = "blue"; }
        else if (level === 1) { labelText = "ë‚®ìŒ"; color = "green"; }
        else if (level === 2) { labelText = "ë³´í†µ"; color = "goldenrod"; }
        else if (level === 3) { labelText = "ë†’ìŒ"; color = "orange"; }
        else if (level === 4) { labelText = "ë§¤ìš° ë†’ìŒ"; color = "red"; }

        document.getElementById("riskDisplay").innerHTML = `
          ğŸŒ¡ï¸ ìœ„í—˜ë„ ì ìˆ˜: <b>${score.toFixed(2)}</b><br>
          ğŸ›‘ ë“±ê¸‰: <b style="color:${color};">${labelText}</b>
        `;
      } catch (e) {
        document.getElementById("riskDisplay").textContent = "âŒ ìœ„í—˜ë„ ë°ì´í„° ì—†ìŒ";
      }
    }

    updateRisk();
    setInterval(updateRisk, 2000);
  </script>
</body>
</html>
